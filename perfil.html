{% extends "base.html" %}
{% block title %}Perfil{% endblock %}

{% block content %}
<h2>Perfil de {{ user.username }}</h2>

<!-- Foto de perfil -->
{% if user.profile_pic %}
<img src="{{ url_for('static', filename=user.profile_pic) }}" alt="Foto de perfil" class="rounded-circle" width="120">
{% endif %}

<!-- Botón editar perfil -->
<a href="{{ url_for('edit_profile') }}" class="btn btn-sm btn-primary mt-2 mb-3">Editar perfil</a>

<!-- Películas favoritas -->
{% if fav_movies %}
<h3>Películas favoritas</h3>
<div class="row g-3 mb-4">
    {% for movie in fav_movies %}
    <div class="col-sm-6 col-md-4 col-lg-3">
        <div class="card bg-secondary text-light">
            {% if movie.poster_path %}
            <img src="{{ url_for('static', filename=movie.poster_path) }}" class="card-img-top" alt="{{ movie.title }}">
            {% endif %}
            <div class="card-body">
                <h5 class="card-title">{{ movie.title }}</h5>
                {% if movie.year %}<p class="card-text"><small>{{ movie.year }}</small></p>{% endif %}
                {% if movie.movieId %}
                <a class="btn btn-sm btn-light" href="{{ url_for('movie_detail', movieId=movie.movieId) }}">Ver detalles</a>
                {% endif %}
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<p>No tienes películas favoritas.</p>
{% endif %}

<!-- Watchlist -->
<h3>Watchlist</h3>
<ul class="list-group mb-4">
    {% for w in watchlist %}
    <li class="list-group-item bg-dark text-light">
        <strong>{{ w.movie.title }}</strong>
    </li>
    {% else %}
    <li class="list-group-item bg-dark text-light">Watchlist vacía</li>
    {% endfor %}
</ul>

<!-- Reseñas -->
<h3>Reseñas</h3>
<ul class="list-group">
    {% for r in reseñas %}
    <li class="list-group-item bg-dark text-light">
        <strong>{{ r.movie.title }}</strong> — {{ r.rating }} ⭐<br>
        {{ r.text }}
    </li>
    {% else %}
    <li class="list-group-item bg-dark text-light">No tienes reseñas.</li>
    {% endfor %}
</ul>
{% endblock %}
